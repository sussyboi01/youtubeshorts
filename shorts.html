<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Google Slides</title>
<link rel="icon" href="https://gstatic.com/docs/presentations/images/presentations_logo144.png" type="image/png">

<style>
  :root { --bg:#0b0b0b; --panel:rgba(0,0,0,0.45); --text:#fff; --accent:#ff3b30; }
  
  html, body { height:100%; margin:0; background:var(--bg); color:var(--text); font-family:Inter,Segoe UI,Roboto,Arial,sans-serif; overflow:hidden; }
  #stack { height:100vh; width:100%; overflow:hidden; }

  .slot {
    height: 100vh;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 16px;
  }
   
  .player-frame {
    width: 360px;
    height: 640px;
    border-radius: 16px;
    overflow: hidden;
    background: #000;
    box-shadow: 0 10px 30px rgba(0,0,0,.6);
    border: 1px solid rgba(255,255,255,.03);
  }
  .player-frame iframe { width:100%; height:100%; border:none; }

  #ui {
    display: flex;
    flex-direction: column;
    gap: 10px;
    align-items: center;
    background: var(--panel);
    padding: 12px;
    border-radius: 12px;
    backdrop-filter: blur(6px);
    min-width: 120px;
  }

  .btn { background:transparent; color:var(--text); border:1px solid rgba(255,255,255,.06); padding:8px 12px; border-radius:8px; cursor:pointer; }
  .heart { font-size:26px; cursor:pointer; user-select:none; }
  .heart.faved { color:var(--accent); }

  /* Overlay Styles */
  #overlay {
    position: fixed;
    top: 0; left: 0; width: 100%; height: 100%;
    background: #000;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    transition: opacity 0.5s ease;
  }
  .overlay-content { text-align: center; color: white; }
  .start-btn {
    margin-top: 20px;
    padding: 15px 30px;
    font-size: 18px;
    background: var(--accent);
    color: white;
    border: none;
    border-radius: 30px;
    cursor: pointer;
    font-weight: bold;
  }
  #overlay.hidden { opacity: 0; pointer-events: none; }
</style>
</head>
<body>

<div id="overlay">
  <div class="overlay-content">
    <h1>YouTube Shorts Feed</h1>
    <p>Press any key or click to start with sound</p>
    <button class="start-btn">Start Watching</button>
  </div>
</div>

<div id="stack">
  <div class="slot" id="slot-cur">
    <div class="player-frame"><iframe id="frame-cur" allow="autoplay; encrypted-media; fullscreen"></iframe></div>
    <div id="ui">
      <button id="upBtn" class="btn">▲ Up</button>
      <div id="favBtn" class="heart">♡</div>
      <button id="downBtn" class="btn">▼ Down</button>
      <button id="gotoFav" class="btn">Favorites</button>
      <button id="gotoYT" class="btn">Youtube</button>
    </div>
  </div>
  <iframe id="frame-prev" style="display:none"></iframe>
  <iframe id="frame-next" style="display:none"></iframe>
</div>

<script>
let feed = [], curIdx = 0, activated = false;

const framePrev = document.getElementById('frame-prev');
const frameCur = document.getElementById('frame-cur');
const frameNext = document.getElementById('frame-next');
const overlay = document.getElementById('overlay');

function activateApp() {
  if (activated) return;
  activated = true;
  overlay.classList.add('hidden');
  postCommand(frameCur, 'playVideo');
}

window.addEventListener('click', activateApp);
window.addEventListener('keydown', activateApp);

function shuffleArray(a){for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]];}return a;}

function buildEmbed(id) {
  return `https://www.youtube.com/embed/${id}?rel=0&autoplay=1&mute=0&enablejsapi=1&playsinline=1`;
}

function setFrame(f, id, isCurrent = false) {
  if (!id) { f.src = 'about:blank'; return; }
  f.src = buildEmbed(id);
  f.onload = () => {
    if (isCurrent && activated) postCommand(f, 'playVideo');
    else postCommand(f, 'pauseVideo');
  };
}

function updateFrames() {
  setFrame(framePrev, feed[curIdx - 1], false);
  setFrame(frameCur, feed[curIdx], true);
  setFrame(frameNext, feed[curIdx + 1], false);
}

function rotateForward() { if(curIdx < feed.length - 1) { curIdx++; updateFrames(); } }
function rotateBackward() { if(curIdx > 0) { curIdx--; updateFrames(); } }

function postCommand(frame, command) {
  if (!frame || !frame.contentWindow) return;
  frame.contentWindow.postMessage(JSON.stringify({event:'command', func:command, args:[]}), '*');
}

/* Event Listeners */
document.getElementById('upBtn').onclick = rotateBackward;
document.getElementById('downBtn').onclick = rotateForward;
window.addEventListener('wheel', e => { if(e.deltaY > 40) rotateForward(); else if(e.deltaY < -40) rotateBackward(); });
window.addEventListener('keydown', e => { if(e.key === 'ArrowDown') rotateForward(); if(e.key === 'ArrowUp') rotateBackward(); });

/* Load Data */
async function loadFeed() {
  try {
    const r = await fetch('feed.json', {cache: 'no-store'});
    feed = shuffleArray(await r.json());
    updateFrames();
  } catch (e) { console.error("Could not load feed.json", e); }
}

loadFeed();
</script>
</body>
</html>
